import json, requests, os, webbrowser
import sys
import zlib 
import base45
import cbor2
from cose.messages import CoseMessage 

BASE_URL = 'https://covid.merlinschumacher.de/'
# payload = sys.argv[1][4:]
# print("decoding payload: "+ payload) # decode Base45 (remove HC1: prefix)
decoded = base45.b45decode("NCFOXN%TSMAHN-HFSC41O/XMD/20MSM52O651WGTJPBBJRH5$JUQC0.HLM$2MDCF/8X*G3M9JUPY0BZW4V/AY73CNN8J3I6HPK3WNNCDB747ERJW9J*KMXUK+UL$HGTDC-JE%7A6IA*$36IASD9YHILIIX2MELNOHKYIA FEK3O+/F9FER-A3DA3NKYJ9/H8RJC--CXHC4CH0UIZHSP6K1H1YXV :KC%C+T4D-4HRVUMNMD3323623-E3NAJB/S7-SN2H N37J3JFTULJQAJ8X2-36D-I/2DBAJDAJCNB-43 X4VV2 73-E3GG3V20-7TZD5WB9I.4Q13U$9LZ68999Q9E$BDZIK4JB.S804EJSVEU59UATSLZIA9J3WTIP2B/9TJ5TYPF68CPI2YU2CKF%CD 810H54PNY0R*1L*SRL6I3786U60VG2OCYTK$9*VFF*H-8IL:UY/P.B7%2SRGMAQ7PZA-TBE.30H7OCQ4SU23WA18OHJIUJPJN::FAQO65MY2LDRJHB0ZZ64+F") # decompress using zlib
decompressed = zlib.decompress(decoded)
# decode COSE message (no signature verification done)
cose = CoseMessage.decode(decompressed)
# decode the CBOR encoded payload and print as json
print(json.dumps(cbor2.loads(cose.payload), indent=2))

# payload = {
#     "dcc": "HC1:NCFOXN%TSMAHN-HFSC41O/XMD/20MSM52O651WGTJPBBJRH5$JUQC0.HLM$2MDCF/8X*G3M9JUPY0BZW4V/AY73CNN8J3I6HPK3WNNCDB747ERJW9J*KMXUK+UL$HGTDC-JE%7A6IA*$36IASD9YHILIIX2MELNOHKYIA FEK3O+/F9FER-A3DA3NKYJ9/H8RJC--CXHC4CH0UIZHSP6K1H1YXV :KC%C+T4D-4HRVUMNMD3323623-E3NAJB/S7-SN2H N37J3JFTULJQAJ8X2-36D-I/2DBAJDAJCNB-43 X4VV2 73-E3GG3V20-7TZD5WB9I.4Q13U$9LZ68999Q9E$BDZIK4JB.S804EJSVEU59UATSLZIA9J3WTIP2B/9TJ5TYPF68CPI2YU2CKF%CD 810H54PNY0R*1L*SRL6I3786U60VG2OCYTK$9*VFF*H-8IL:UY/P.B7%2SRGMAQ7PZA-TBE.30H7OCQ4SU23WA18OHJIUJPJN::FAQO65MY2LDRJHB0ZZ64+F"
# }

# r = requests.get(BASE_URL, payload,json=payload)
# if r.status_code != 200:
#         data=0
# data = r.json()
# print(data)